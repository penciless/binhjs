!function(){var i=window,s=i.Binh,T=s.Router;function c(e){sessionStorage.setItem(u.KEY_AUTH_VALIDATED,!0),sessionStorage.removeItem(u.KEY_AUTH_REDIRECTED),T.navigate(e)}const u={KEY_AUTH_REDIRECTED:"authRedirected",KEY_AUTH_USER:"auth",KEY_AUTH_VALIDATED:"validated",STATUS_AUTH_NONE:"none",STATUS_AUTH_EXPIRED:"expired",STATUS_AUTH_VALID:"valid"};function e(e){var r,t,n,e=E(e);e.error||(r=e.searchParams,sessionStorage.setItem(u.KEY_AUTH_REDIRECTED,!0),(t=a()).status===u.STATUS_AUTH_EXPIRED&&localStorage.removeItem(u.KEY_AUTH_USER),n=i.location.href,r.append("userID",t.id),r.append("status",t.status),r.append("reURL",n),i.location=e.href)}function a(){var e,r=function(){try{return JSON.parse(localStorage.getItem(u.KEY_AUTH_USER))}catch(e){return null}}(),t=(r=r?(e=r.exp<Date.now()/1e3?u.STATUS_AUTH_EXPIRED:u.STATUS_AUTH_VALID,r.id):(e=u.STATUS_AUTH_NONE,""),function(){var e=i.performance;if(e.getEntriesByType){var r=e.getEntriesByType("navigation");if(r&&0<r.length)return r[0].type}if(e.navigation)switch(e.navigation.type){case 0:return"navigate";case 1:return"reload";case 2:return"back_forward";default:return null}return null}()),n="back_forward"===t,a="navigate"===t&&sessionStorage.hasOwnProperty(u.KEY_AUTH_REDIRECTED),t="reload"!==t&&sessionStorage.hasOwnProperty(u.KEY_AUTH_VALIDATED);return{id:r,status:e,safeSSO:e!==u.STATUS_AUTH_NONE&&!t&&!n&&!a}}function E(r){try{return new URL(r)}catch(e){return console.error("[BINH-AUTH] Invalid URL",r,"-",e),{error:e}}}(s.Auth=e).current=a,e.RedirectHandler=function(o){return o=o||{},function(){var e=T.query(),r=E(e.reURL);if(r.error)c("/");else if(i.location.origin!==r.origin)c("/"),console.error("[BINH-AUTH] The redirected URL must be the same origin as the client.");else switch(e.status){case"in":n();break;case"new":localStorage.removeItem(u.KEY_AUTH_USER);var t=E(o.clientTokenAPI);t.error?a(e.token):new s.http(t.href).auth(e.token).get(function(e){a(e)});break;default:localStorage.removeItem(u.KEY_AUTH_USER),n()}function n(){c(r.href.replace(r.origin,""))}function a(e){(e=function(e){try{return atob(e.split(".")[1])}catch(e){return null}}(e))&&localStorage.setItem(u.KEY_AUTH_USER,e),n()}}}}();