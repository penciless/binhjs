!function(){var i=window,c=i.Binh,T=c.Router,s=T.navigate;const u={KEY_AUTH_REDIRECTED:"authRedirected",KEY_AUTH_USER:"auth",STATUS_AUTH_NONE:"none",STATUS_AUTH_EXPIRED:"expired",STATUS_AUTH_VALID:"valid"};function e(e){var r,t,n,a=function(){var e=i.performance;if(e.getEntriesByType){var r=e.getEntriesByType("navigation");if(r&&0<r.length)return r[0].type}if(e.navigation)switch(e.navigation.type){case 0:return"navigate";case 1:return"reload";case 2:return"back_forward";default:return null}return null}();"back_forward"===a||(e=E(e)).error||(r=e.searchParams,sessionStorage.hasOwnProperty(u.KEY_AUTH_REDIRECTED)?a&&sessionStorage.removeItem(u.KEY_AUTH_REDIRECTED):(sessionStorage.setItem(u.KEY_AUTH_REDIRECTED,!0),a=(a=localStorage.getItem(u.KEY_AUTH_USER))?(t=a.exp<Date.now()/1e3?(localStorage.removeItem(u.KEY_AUTH_USER),u.STATUS_AUTH_EXPIRED):u.STATUS_AUTH_VALID,a.id):(t=u.STATUS_AUTH_NONE,""),n=i.location.href,r.append("userID",a),r.append("status",t),r.append("reURL",n),i.location=e.href))}function E(r){try{return new URL(r)}catch(e){return console.error("[BINH-AUTH] Invalid URL",r,"-",e),{error:e}}}(c.Auth=e).RedirectHandler=function(o){return o=o||{},function(){var e=T.query(),r=E(e.reURL);if(r.error)s("/");else if(i.location.origin!==r.origin)s("/"),console.error("[BINH-AUTH] The redirected URL must be the same origin as the client.");else switch(e.status){case"in":n();break;case"new":localStorage.removeItem(u.KEY_AUTH_USER);var t=E(o.clientTokenAPI);t.error?a(e.token):new c.http(t.href).auth(e.token).get(function(e){a(e)});break;default:localStorage.removeItem(u.KEY_AUTH_USER),n()}function n(){s(r.href.replace(location.origin,""))}function a(e){(e=function(e){try{return atob(e.split(".")[1])}catch(e){return null}}(e))&&localStorage.setItem(u.KEY_AUTH_USER,e),n()}}}}();