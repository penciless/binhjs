!function(){var i=window,c=i.Binh,u=c.Router,s=u.navigate;const T={KEY_AUTH_REDIRECTED:"authRedirected",KEY_AUTH_USER:"auth",STATUS_AUTH_NONE:"none",STATUS_AUTH_EXPIRED:"expired",STATUS_AUTH_VALID:"valid"};function e(e){var r,t,n,a=function(){var e=i.performance;if(e.getEntriesByType){var r=e.getEntriesByType("navigation");if(r&&0<r.length)return r[0].type}if(e.navigation)switch(e.navigation.type){case 0:return"navigate";case 1:return"reload";case 2:return"back_forward";default:return null}return null}();"back_forward"===a||(e=l(e)).error||(r=e.searchParams,sessionStorage.hasOwnProperty(T.KEY_AUTH_REDIRECTED)?a&&sessionStorage.removeItem(T.KEY_AUTH_REDIRECTED):(sessionStorage.setItem(T.KEY_AUTH_REDIRECTED,!0),a=(a=function(){try{return JSON.parse(localStorage.getItem(T.KEY_AUTH_USER))}catch(e){return null}}())?(t=a.exp<Date.now()/1e3?(localStorage.removeItem(T.KEY_AUTH_USER),T.STATUS_AUTH_EXPIRED):T.STATUS_AUTH_VALID,a.id):(t=T.STATUS_AUTH_NONE,""),n=i.location.href,r.append("userID",a),r.append("status",t),r.append("reURL",n),i.location=e.href))}function l(r){try{return new URL(r)}catch(e){return console.error("[BINH-AUTH] Invalid URL",r,"-",e),{error:e}}}(c.Auth=e).RedirectHandler=function(o){return o=o||{},function(){var e=u.query(),r=l(e.reURL);if(r.error)s("/");else if(i.location.origin!==r.origin)s("/"),console.error("[BINH-AUTH] The redirected URL must be the same origin as the client.");else switch(e.status){case"in":n();break;case"new":localStorage.removeItem(T.KEY_AUTH_USER);var t=l(o.clientTokenAPI);t.error?a(e.token):new c.http(t.href).auth(e.token).get(function(e){a(e)});break;default:localStorage.removeItem(T.KEY_AUTH_USER),n()}function n(){s(r.href.replace(r.origin,""))}function a(e){(e=function(e){try{return atob(e.split(".")[1])}catch(e){return null}}(e))&&localStorage.setItem(T.KEY_AUTH_USER,e),n()}}}}();