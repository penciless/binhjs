!function(){var i=window,c=i.Binh,s=c.Router;const o={NONE:"none",VALID:"valid",EXPIRED:"expired"},u={KEY_USER:"auth-user",KEY_RECHECK:"auth-recheck",KEY_REDIRECTED:"auth-redirected"};function r(e){var r,t,n,e=l(e);e.error||(r=e.searchParams,sessionStorage.setItem(u.KEY_REDIRECTED,!0),(t=a()).status===o.EXPIRED&&localStorage.removeItem(u.KEY_USER),n=i.location.href,r.append("userID",t.id),r.append("status",t.status),r.append("reURL",n),i.location=e.href)}function E(e){sessionStorage.setItem(u.KEY_RECHECK,!0),sessionStorage.removeItem(u.KEY_REDIRECTED),s.navigate(e)}function l(r){try{return new URL(r)}catch(e){return console.error("[BINH-AUTH] Invalid URL",r,"-",e),{error:e}}}function a(){var e,r=function(){try{return JSON.parse(localStorage.getItem(u.KEY_USER))}catch(e){return null}}(),t=(r=r?(e=r.exp<Date.now()/1e3?o.EXPIRED:o.VALID,r.id):(e=o.NONE,""),function(){var e=i.performance;if(e.getEntriesByType){var r=e.getEntriesByType("navigation");if(r&&0<r.length)return r[0].type}if(e.navigation)switch(e.navigation.type){case 0:return"navigate";case 1:return"reload";case 2:return"back_forward";default:return null}return null}()),n="back_forward"===t,a="navigate"===t&&sessionStorage.hasOwnProperty(u.KEY_REDIRECTED),t="reload"!==t&&sessionStorage.hasOwnProperty(u.KEY_RECHECK);return{id:r,status:e,safeToSync:e!==o.NONE&&!t&&!n&&!a}}(c.Auth=u).check=a,u.sync=function(e){a().safeToSync&&r(e)},u.login=function(e){r(e)},u.route=function(o){return o=o||{},function(){var e=s.query(),r=l(e.reURL);if(r.error)E("/"),console.error("[BINH-AUTH] Invalid redirected URL.");else if(i.location.origin!==r.origin)E("/"),console.error("[BINH-AUTH] The redirected URL must be the same origin as the client.");else switch(e.status){case"in":n();break;case"new":localStorage.removeItem(u.KEY_USER);var t=l(o.clientTokenAPI);t.error?a(e.token):new c.http(t.href).credentials().auth(e.token).get(function(e){a(e)});break;default:localStorage.removeItem(u.KEY_USER),n()}function n(){E(r.href.replace(r.origin,""))}function a(e){(e=function(e){try{return atob(e.split(".")[1])}catch(e){return null}}(e))&&localStorage.setItem(u.KEY_USER,e),n()}}}}();