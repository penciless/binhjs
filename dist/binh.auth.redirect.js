!function(){var s=window,i=s.Binh,T=i.Router;function c(e){sessionStorage.setItem(u.KEY_AUTH_VALIDATED,!0),sessionStorage.removeItem(u.KEY_AUTH_REDIRECTED),T.navigate(e)}const u={KEY_AUTH_REDIRECTED:"authRedirected",KEY_AUTH_USER:"auth",KEY_AUTH_VALIDATED:"validated",STATUS_AUTH_NONE:"none",STATUS_AUTH_EXPIRED:"expired",STATUS_AUTH_VALID:"valid"};function e(e){var t,r,n,e=E(e);e.error||(t=e.searchParams,sessionStorage.setItem(u.KEY_AUTH_REDIRECTED,!0),(r=a()).status===u.STATUS_AUTH_EXPIRED&&localStorage.removeItem(u.KEY_AUTH_USER),n=s.location.href,t.append("userID",r.id),t.append("status",r.status),t.append("reURL",n),s.location=e.href)}function a(){var e,t=function(){try{return JSON.parse(localStorage.getItem(u.KEY_AUTH_USER))}catch(e){return null}}(),r=(t=t?(e=t.exp<Date.now()/1e3?u.STATUS_AUTH_EXPIRED:u.STATUS_AUTH_VALID,t.id):(e=u.STATUS_AUTH_NONE,""),function(){var e=s.performance;if(e.getEntriesByType){var t=e.getEntriesByType("navigation");if(t&&0<t.length)return t[0].type}if(e.navigation)switch(e.navigation.type){case 0:return"navigate";case 1:return"reload";case 2:return"back_forward";default:return null}return null}()),n="back_forward"===r,a="navigate"===r&&sessionStorage.hasOwnProperty(u.KEY_AUTH_REDIRECTED),o="reload"!==r&&sessionStorage.hasOwnProperty(u.KEY_AUTH_VALIDATED),i=e!==u.STATUS_AUTH_NONE;return console.log("~ navigation",r),{id:t,status:e,safeSSO:i&&!o&&!n&&!a}}function E(t){try{return new URL(t)}catch(e){return console.error("[BINH-AUTH] Invalid URL",t,"-",e),{error:e}}}(i.Auth=e).current=a,e.RedirectHandler=function(o){return o=o||{},function(){var e=T.query(),t=E(e.reURL);if(t.error)c("/");else if(s.location.origin!==t.origin)c("/"),console.error("[BINH-AUTH] The redirected URL must be the same origin as the client.");else switch(e.status){case"in":n();break;case"new":localStorage.removeItem(u.KEY_AUTH_USER);var r=E(o.clientTokenAPI);r.error?a(e.token):new i.http(r.href).auth(e.token).get(function(e){a(e)});break;default:localStorage.removeItem(u.KEY_AUTH_USER),n()}function n(){c(t.href.replace(t.origin,""))}function a(e){(e=function(e){try{return atob(e.split(".")[1])}catch(e){return null}}(e))&&localStorage.setItem(u.KEY_AUTH_USER,e),n()}}}}();