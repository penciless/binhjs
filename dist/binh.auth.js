!function(){function f(n){window.addEventListener("message",n,!1)}window.BinhAuth=function(n){var t,e,o,i={request:"authenticate"},r=new URL(n).origin,a=function(n){return n=Binh.el("iframe")({src:n}),document.head.appendChild(n.element),n.element}(n).contentWindow;function s(n){a.postMessage(n,r)}var c=setInterval(s.bind(null,{request:"available"}));function u(n){n.origin===r&&(n.stopImmediatePropagation(),n.data)&&!0===n.data.available&&(e=!0,window.clearInterval(c),window.removeEventListener("message",u,!1),i.invoked)&&s(i)}f(u),f(function(n){if(n.origin===r){n.stopImmediatePropagation();n=n.data;if(n&&!n.available)return n.error?console.error(n.error):void(n.accessToken&&o&&o!=n.customTokenAPI?fetch(new Request(o,{headers:{Authorization:"Bearer "+n.accessToken}})).then(function(n){return n.text()}).then(function(n){s({request:"saveCustomToken",customToken:t=n,customTokenAPI:o}),h(n)}).catch(function(){throw new Error("BinhAuth - Error fetching custom access token from:"+o)}):(t=n.accessToken,h(t)))}}),this.login=function(){return e?setTimeout(s.bind(null,i)):i.invoked=!0,this},this.customTokenAPI=function(n){return new URL(n)&&(o=n),this};var h=function(){};this.handleToken=function(n){return h=n instanceof Function?n:function(){},this},this.logout=function(n){},this.data=function(n){try{var e=JSON.parse(atob(t.split(".")[1]));n instanceof Function&&n(e)}catch(n){throw new Error("BinhAuth - Cannot parse data from access token properly.")}}}}();