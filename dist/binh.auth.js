!function(){function d(n){window.addEventListener("message",n,!1)}window.BinhAuth=function(n){var t,e,o,i={request:"authenticate"},r=new URL(n).origin,a=function(n){return n=Binh.el("iframe")({src:n}),document.head.appendChild(n.element),n.element}(n).contentWindow;function c(n){a.postMessage(n,r)}var u=setInterval(c.bind(null,{request:"connect"}),100);function s(n){n.origin===r&&(n.stopImmediatePropagation(),n.data)&&!0===n.data.connected&&(e=!0,window.clearInterval(u),window.removeEventListener("message",s,!1),i.invoked)&&c(i)}d(s),d(function(n){if(n.origin===r)return n.stopImmediatePropagation(),(n=n.data).loggedOut?h():n&&!n.connected?n.error?console.error(n.error):void(n.remoteToken&&o&&o!=n.customTokenAPI?fetch(new Request(o,{headers:{Authorization:"Bearer "+n.remoteToken}})).then(function(n){return n.text()}).then(function(n){c({request:"saveCustomToken",customToken:t=n,customTokenAPI:o}),h(n)}).catch(function(){throw new Error("BinhAuth - Error fetching custom access token from:"+o)}):(t=n.remoteToken,h(t))):void 0}),this.login=function(n){return this.handleToken(n),e?setTimeout(c.bind(null,i)):i.invoked=!0,this},this.customTokenAPI=function(n){return new URL(n)&&(o=n),this};var h=function(){};this.handleToken=function(n){return h=n instanceof Function?n:function(){},this},this.logout=function(n){},this.data=function(n){try{var e=JSON.parse(atob(t.split(".")[1]));n instanceof Function&&n(e)}catch(n){throw new Error("BinhAuth - Cannot parse data from access token properly.")}}}}();