function Binh(n,t){var e=Binh.settings;Binh.element.apply(Binh,e.elements),Binh.state=new Binh.State,Binh.ScriptService=new Binh.ScriptLoader(e.buildServiceURL||e.buildDefaultURL),Binh.ScriptComponent=new Binh.ScriptLoader(e.buildComponentURL||e.buildDefaultURL),document.addEventListener("DOMContentLoaded",function e(){document.removeEventListener("DOMContentLoaded",e),(t=t||{}).element=t.element||document.body,new Binh.Router(n,t)})}Binh.settings={elements:["div","span","a","nav","ul","li"],buildDefaultURL:null,buildServiceURL:null,buildComponentURL:null},Binh.class=function(e,n){(n.prototype.Binh=Binh)[e]=n},function(){Binh.iid=function(){return this.iid++}.bind({iid:0});var i={};Binh.el=function(e){return i[e]||(i[e]=function(e){var n=document.createElement(this.tagname);return n.constructor=Element,new this.ElementNode(n)(e)}.bind({tagname:e,ElementNode:Binh.ElementNode}))},Binh.element=function(e){for(var arguments=e instanceof Array?e:arguments||[e],n=arguments.length,t=0;t<n;t++)this.el(arguments[t]);return i},Binh.elements=i}(),Binh.class("Component",function(){}),function(){var a=Binh.services||{},s=(Binh.services=a,{}),r=(Binh.components=s,Binh.component=function(e,n){var t,i=Binh.Component,o={};for(t in(n=n.bind(o)).prototype=o,n.constructor=i,o.name=e,o.id=e+Binh.iid(),o.constructor=i,r)o[t]=r[t];s[e]=n},{}),m=(r.el=Binh.el,r.style=function(e,n){(this.stylesheets=this.stylesheets||{})[e]=n},{});r.component=function(e,n){i=n,a=m[t=e]||(m[t]=new Binh.ScriptLoader),0===t.indexOf("https://cdn.jsdelivr.net/")?(o=t.split("https://cdn.jsdelivr.net/")[1],r=[],i.forEach(function(e){var n=a.meta(e);n.loading||n.loaded||r.push(o+"/"+e+".js")}),s="https://cdn.jsdelivr.net/combine/"+r.join(","),a.buildURL=function(){return s}):a.buildURL=a.buildURL||function(e){return t+"/"+e+".js"};for(var t,i,o,r,s,a,c=a,u=n.length,l=c.storage,h=0;h<u;h++){var d,f,p=n[h];l[p]||((f=v.bind({fake_elements:d=[],component_name:p,source_url:e,components:l})).constructor=Binh.Component,f.fake=!0,l[p]=f,c.require(p,y.bind({fake_elements:d,component_name:p,source_url:e,components:l})))}return l},Binh.require=r.component;var v=function(){var e,n=this.components[this.component_name];return n.fake?(e=Binh.el("fake")(),this.fake_elements.push(e.element),e.element.fake=!0,e.args=arguments,e):n.apply(null,arguments)};function y(){var r=s[this.component_name];this.components[this.component_name]=r,this.fake_elements.forEach(function(e){var n=e.parentNode,t=e.elementnode,i=r.apply(null,t.args),o=i.element;t.element=o||{},n&&n.replaceChild(o,e),i.actions=t.actions,t.ready()})}function c(){var e=a[this.service_name],n=this.fake_service;delete n.fake,n.processes=e.processes,n.ready()}r.service=function(e){for(var arguments=e instanceof Array?e:arguments||[e],n=arguments.length,t=a,i=Binh.Service,o=0;o<n;o++){var r,s=arguments[o];t[s]||(r=new i(function(){this.fake=!0}),t[s]=r,Binh.ScriptService.require(s,c.bind({fake_service:r,service_name:s})))}return t}}(),Binh.class("ElementNode",function(e){var n,s=this.handlers;function a(e){for(var arguments=arguments||[e],n=arguments.length,t=a.element,i=s,o=0;o<n;o++){var r=arguments[o];i[typeof r](t,r)}return a}for(n in this)a[n]=this[n];return delete a.Binh,delete a.handlers,a.element=e,a.constructor=Binh.ElementNode,e.elementnode=a}),function(){var i=Binh.ElementNode,e=i.prototype;function n(e,n){e.appendChild(document.createTextNode(n))}e.ready=function(e){var n=!this.element.fake,t=this.ready_queue=this.ready_queue||[];if(e instanceof Function&&t.push(e),n)for(;t.length;)t.shift()();return n},e.clone=function(e){var n=this;this.ready(function(){e instanceof Function&&e(new i(n.element.cloneNode()))})},e.on=function(e,n){var t=this;return this.ready(function(){t.element.addEventListener(e,n)}),this},e.when=function(e,n){return this.actions=this.actions||{},this.actions[e]=n,this},e.does=function(e,n,t){return this.actions=this.actions||{},this.actions[e]instanceof Function&&this.actions[e](n,t),this},e.subscribe=function(e,n){var t=this;return this.ready(function(){Binh.state.listen(e,n,t)}),this},e.empty=function(){var e=this.element,n=e.parentNode,t=e.cloneNode();return n&&n.replaceChild(t,e),this.element=t,this},e.style=function(e,n){this.element.classList.add(e.id,n);var t,i,o,r,s=e.id+n;return document.head.querySelector("#"+s)||(t=(e.stylesheets=e.stylesheets||{})[n],i="."+e.id+"."+n+" ","string"==typeof t?((o=document.createElement("link")).rel="stylesheet",o.type="text/css",o.href=t,o.id=s,o.onload=function(){!function e(n,t){var i=n.cssRules,o=i.length;for(var r=0;r<o;r++){var s=i.item(r);s.cssRules&&e(s,t),s.selectorText=t+s.selectorText}}(o.sheet,i)},document.head.appendChild(o)):t instanceof Function&&(r=document.createElement("style"),document.head.appendChild(r),r.id=s,t(function(e,n){var t="";n&&n.parsed?t=n.parsed:n instanceof Array&&(t="{"+n.join(";")+"}",n.parsed=t);r.sheet.insertRule(i+e+t)}))),this},e.handlers={string:n,number:n,object:function(n,e){if(null!=e)switch(e.constructor){case Array:var t=this;e.forEach(function(e){t[typeof e](n,e)});break;case Binh.Router:case Element:n.appendChild(e.element||e);break;default:for(var i in e)n.setAttribute(i,e[i])}},function:function(e,n){switch(n.constructor){case Binh.Component:case i:var t=n.element||n().element;e.appendChild(t);break;case Binh.ElementEvent:e["on"+n.event_name]=n;break;default:n(e)}},undefined:function(){}}}(),Binh.class("http",function(e){this.url=e,this.parameters=[]}),function(){var e=Binh.http,n=e.prototype;e.defer=function(e){var arguments=e instanceof Array?e:arguments||[e],n=arguments.length,t=[],i=function(){};t.count=0,t.results=[],t.ready=function(e){this.count++,this.results[e.index]=e,this.count===this.length&&i instanceof Function&&i.apply(null,this.results)};for(var o=0;o<n;o++){var r=arguments[o];r.defers=r.defers||[],r.defers.push({defer:t,index:o}),t.push(r)}return{done:function(e){i=e instanceof Function?e:function(){}}}},n.get=function(e){return this.request("GET",e)},n.post=function(e){return this.request("POST",e)},n.request=function(e,n){var t,i=this.init(n),o=(i.open(e,this.url+this.parameters.join("/")+(this.queries||"")),this.payload&&i.setRequestHeader("Content-Type","application/json"),this.headers);for(t in o)i.setRequestHeader(t,o[t]);return i.send(this.payload),this},n.init=function(e){var t=this,i=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");return i.onreadystatechange=function(){if(i.readyState==XMLHttpRequest.DONE){var n;try{n=JSON.parse(i.responseText)}catch(e){n=i.responseText}e instanceof Function&&e(n,i),t.defers instanceof Array&&t.defers.forEach(function(e){e.defer.ready({response:n,xhttp:i,index:e.index})})}},i},n.header=function(e){return this.headers=e,this},n.body=function(e){return this.payload=JSON.stringify(e),this},n.parameter=function(e){var n;return e instanceof Array&&(n=this.url[this.url.length-1],this.parameters=("/"===n?[]:[""]).concat(e)),this},n.query=function(e){var n,t="";for(n in e)t+=n+"="+e[n]+"&";return this.queries="?"+t,this}}(),Binh.class("ScriptLoader",function(e){this.metadata={},this.storage={},this.links={},this.buildURL=e}),function(){var e=Binh.ScriptLoader.prototype;e.meta=function(e){return this.metadata[e]||(this.metadata[e]={})},e.link=function(e){return this.links[e]||(this.links[e]={})},e.require=function(e,t,i){var o,r,s=this.meta(e);!s.loading&&!s.loaded&&(r=!1,e=(o=this).buildURL(e,function(e,n){r||("script"===n?o.addScript(e,s,t):s.loading||o.link(e).requested||(o.link(e).requested=!0,o.loadScript(e,s,t,i)))}))&&(r=!0,o.link(e).requested||(o.link(e).requested=!0,o.loadScript(e,s,t,i)))},e.addScript=function(e,n,t){var i=document.createElement("script");i.appendChild(document.createTextNode(e)),document.head.appendChild(i),n.type="script",n.loaded=!0,t instanceof Function&&t(),i.remove()},e.loadScript=function(e,n,t,i){var o=document.createElement("script");o.src=e,document.head.appendChild(o),n.loading=!0,o.onload=function(){n.type="url",n.loaded=!0,n.loading=!1,t instanceof Function&&t(),o.remove()},o.onerror=function(){n.loading=!1,i instanceof Function&&i(),o.remove()}}}(),Binh.class("Router",function(o,e){var r,s=!0,a=this,o=o||{},e=e||{},c=(a.element=e.element||document.createElement("div"),a.constructor=Binh.Router,a.load=function(e){var n,t,i;s||document.contains(a.element)?(n=!(e instanceof Event),t=location.pathname,((i=o[t]||o["/"+t]||o[""])&&i!==r||n)&&(console.log("--------------------"),console.log("Load Route:",t),console.log("Location:",location.pathname),console.log("Event:",e?e.type:"route"),console.log("Bind El:",a.element),console.log("Handle:",i,typeof i),console.log("Query:",a.query()),r=i,a.handlers[typeof i](i,a))):(window.removeEventListener("popstate",c),window.removeEventListener("load",c))});window.addEventListener("popstate",c),window.addEventListener("load",c),a.load(),s=!1}),function(){var e=Binh.Router.prototype;e.navigate=function(e,n){history.pushState(n||{},null,e),Binh.Util.emitEvent(window,"load")},Binh.Router.navigate=e.navigate,e.REGEX_ROUTE=new RegExp(".*/(.*?)(/|$).*"),e.currentRoute=function(){return location.pathname.replace(this.REGEX_ROUTE,"$1")},e.REGEX_QUERIES=/(.*?)=(.*?)(&|$)/g,e.query=function(){return JSON.parse("{"+decodeURIComponent(location.search.substring(1).replace(this.REGEX_QUERIES,'"$1":"$2",').slice(0,-1))+"}")},e.handlers={object:function(e,n){var t=e[0],e=e[1],t=Binh.require(t,[e])[e];n.handlers.function(t,n)},string:function(e,n){var t=Binh.components[e];t instanceof Function?n.handlers.function(t,n):Binh.ScriptComponent.require(e,function(){n.handlers.string(e,n)})},number:function(e,n){n.element.appendChild(document.createTextNode(e))},function:function(e,n){var t,i,o,e=e.element||e();if(e instanceof String)return this.string(e,n);(e instanceof Element||(e=e.element)instanceof Element)&&(i=(t=n.element).parentNode,(o=t.cloneNode()).appendChild(e),i&&i.replaceChild(o,t),n.element=o)},undefined:function(){}}}(),Binh.class("Service",function(e){this.processes={},this.queue=[],e.bind(this)()}),function(){var t=Binh.services||{},e=(Binh.services=t,Binh.service=function(e,n){t[e]=new Binh.Service(n)},Binh.Service.prototype);e.define=function(e,n){n instanceof Function&&(this.processes[e]=n)},e.does=function(e){return t="does",e=e,(n=this).processes[e]||(n.processes[e]=(i=n,o=t,r=e,function(){i.fake?i.queue.push({type:o,name:r,args:arguments}):i[o](r).apply(null,arguments)}));var n,t,i,o,r},e.once=function(e,n){},e.debounce=function(e,n){},e.throttle=function(e,n){},e.ready=function(){var e=!this.fake,n=this.queue;if(e)for(;n.length;){var t=n.shift();this[t.type](t.name).apply(null,t.args)}return e}}(),Binh.class("State",function(){var t={};function o(e){var n=t[e]||{};return t[e]=n}this.set=function(e,n){var t=o(e);t.value=n,this.emitLater(e,t)},this.edit=function(e,n){var t=o(e);n(t.value),this.emitLater(e,t)},this.emitLater=function(e,n){var t=this;clearTimeout(this.emitId),this.emitId=setTimeout(function(){t.emit(e,n)})},this.emit=function(e,t){(t=t||o(e)).listeners instanceof Array&&t.listeners.forEach(function(e,n){if(function(e){var n=e.elementnode,n=n&&n.element instanceof Element,t=document.contains(e.element),i=e.domed;t&&!i&&(e.domed=!0);return n&&i&&!t}(e))return t.listeners.splice(n,1);n=JSON.parse(JSON.stringify(t.value));e.handler(n)})},this.listen=function(e,n,t){var i=o(e);i.listeners=i.listeners||[],i.listeners.push({elementnode:t,handler:n}),this.update(e,i),null!=i.value&&n(i.value)},this.schema=function(e,n){var t=o(e);n instanceof Function&&(t.fetch=n,t.listeners)&&t.listeners.length&&this.update(e,t)},this.update=function(n,t){var i;(t=t||o(n)).fetch instanceof Function&&(t.fetching||(t.fetching=!0,i=this,t.fetch(function(e){i.set(n,e),t.fetching=!1})))},this.as=function(e){var n=o(e);if(n.as)return n.as;var t,i=n.as={};for(t in this)i[t]=this[t].bind(this,e);return i}}),Binh.Util={emitEvent:function(e,n){var t;document.createEvent?("function"==typeof Event?t=new Event(n):(t=document.createEvent("Event")).initEvent(n,!1,!0),e.dispatchEvent(t)):((t=document.createEventObject()).eventName=t.eventType=n,e.fireEvent("on"+t.eventType,t))}};