!function(){const s=function(){},u={},c=function(){return this.iid++}.bind({iid:0});function r(t,o,i){return function(n,e){n.id=c(),t.connected?o.postMessage(n,i):t.pendingRequests.push(function(){o.postMessage(n,i)}),u[n.id]=e instanceof Function?e:s}}Binh.Auth=function(n){var t,o;const i=this,e=i.origin=new URL(n).origin,c=(i.connected=!1,i.pendingRequests=[],function(t,o){const n=document.createElement("iframe"),e=(n.src=o,document.head.appendChild(n),n.contentWindow),i=t.origin,c=t.pendingRequests;console.log("1. Connect to Auth Service:",o);var s=setInterval(function(){console.log("--- (1) connecting...",i),e.postMessage({id:-1,action:"connect"},i)},1e3);function r(n){var e;n.origin===i&&(n=n.data||{},(e=u[n.id])instanceof Function&&e(n),delete u[n.id])}return window.addEventListener("message",function n(e){if(e.origin===i)for(console.log("2. Connected to Auth Service:",o),t.connected=!0,clearInterval(s),window.removeEventListener("message",n,!1),window.addEventListener("message",r,!1);c.length;)c.shift()()},!1),e}(i,n));i.sendMessage=new r(i,c,e),i.login=function(e){return e=e instanceof Function?e:s,i.sendMessage({action:"authenticate"},function(n){if(n.loggedOut)return e();if(n.error)return e(null,n.error);n.remoteToken&&"string"==typeof t&&t!==n.customTokenAPI?fetch(new Request(t,{headers:{Authorization:"Bearer "+n.remoteToken}})).then(function(n){return n.text()}).then(function(n){i.sendMessage({action:"saveCustomToken",customToken:n,customTokenAPI:t}),e(n)}).catch(function(n){e(null,n)}):(o=n.remoteToken,e(n.remoteToken))}),i},i.setCustomTokenAPI=function(n){return new URL(n)&&(t=n),i},i.logout=function(n){},i.data=function(e){e=e instanceof Function?e:s;try{e(JSON.parse(atob(o.split(".")[1])))}catch(n){e(null,n)}},cc=i}}();